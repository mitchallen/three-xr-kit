{"version":3,"file":"three-xr-kit.module.js","sources":["../src/three-xr-kit.js"],"sourcesContent":["/*\n * For XRBUTTON copied from VRButton:\n * See: https://threejs.org/docs/#manual/en/introduction/How-to-create-VR-content\n * Copied from:\n *     https://raw.githubusercontent.com/mrdoob/three.js/master/examples/jsm/webxr/VRButton.js\n */\n\nexport class XRBUTTON {\n\tstatic createButton( renderer ) {\n    console.log('XRBUTTON.createButton');\n    const button = document.createElement( 'button' );\n    \n\t\tfunction showEnterVR( /*device*/ ) {\n\t\t\tlet currentSession = null;\n\t\t\tfunction onSessionStarted( session ) {\n\t\t\t\tsession.addEventListener( 'end', onSessionEnded );\n\t\t\t\trenderer.xr.setSession( session );\n\t\t\t\tbutton.textContent = 'EXIT VR';\n\t\t\t\tcurrentSession = session;\n\t\t\t}\n\n\t\t\tfunction onSessionEnded( /*event*/ ) {\n\t\t\t\tcurrentSession.removeEventListener( 'end', onSessionEnded );\n\t\t\t\tbutton.textContent = 'ENTER VR';\n\t\t\t\tcurrentSession = null;\n\t\t\t}\n\n\t\t\tbutton.style.display = '';\n\t\t\tbutton.style.cursor = 'pointer';\n\t\t\tbutton.style.left = 'calc(50% - 50px)';\n\t\t\tbutton.style.width = '100px';\n      button.textContent = 'ENTER VR';\n      \n\t\t\tbutton.onmouseenter = function () {\n\t\t\t\tbutton.style.opacity = '1.0';\n\t\t\t};\n\n\t\t\tbutton.onmouseleave = function () {\n\t\t\t\tbutton.style.opacity = '0.5';\n\t\t\t};\n\n\t\t\tbutton.onclick = function () {\n\t\t\t\tif ( currentSession === null ) {\n\t\t\t\t\t// WebXR's requestReferenceSpace only works if the corresponding feature\n\t\t\t\t\t// was requested at session creation time. For simplicity, just ask for\n\t\t\t\t\t// the interesting ones as optional features, but be aware that the\n\t\t\t\t\t// requestReferenceSpace call will fail if it turns out to be unavailable.\n\t\t\t\t\t// ('local' is always available for immersive sessions and doesn't need to\n\t\t\t\t\t// be requested separately.)\n\t\t\t\t\tconst sessionInit = { optionalFeatures: [ 'local-floor', 'bounded-floor', 'hand-tracking' ] };\n\t\t\t\t\tnavigator.xr.requestSession( 'immersive-vr', sessionInit ).then( onSessionStarted );\n\t\t\t\t} else {\n\t\t\t\t\tcurrentSession.end();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tfunction disableButton() {\n\t\t\tbutton.style.display = '';\n\t\t\tbutton.style.cursor = 'auto';\n\t\t\tbutton.style.left = 'calc(50% - 75px)';\n\t\t\tbutton.style.width = '150px';\n\t\t\tbutton.onmouseenter = null;\n\t\t\tbutton.onmouseleave = null;\n\t\t\tbutton.onclick = null;\n\t\t}\n\n\t\tfunction showWebXRNotFound() {\n\t\t\tdisableButton();\n\t\t\tbutton.textContent = 'VR NOT SUPPORTED';\n\n\t\t}\n\n\t\tfunction stylizeElement( element ) {\n\t\t\telement.style.position = 'absolute';\n\t\t\telement.style.bottom = '20px';\n\t\t\telement.style.padding = '12px 6px';\n\t\t\telement.style.border = '1px solid #fff';\n\t\t\telement.style.borderRadius = '4px';\n\t\t\telement.style.background = 'rgba(0,0,0,0.1)';\n\t\t\telement.style.color = '#fff';\n\t\t\telement.style.font = 'normal 13px sans-serif';\n\t\t\telement.style.textAlign = 'center';\n\t\t\telement.style.opacity = '0.5';\n\t\t\telement.style.outline = 'none';\n\t\t\telement.style.zIndex = '999';\n\t\t}\n\n\t\tif ( 'xr' in navigator ) {\n\t\t\tbutton.id = 'VRButton';\n\t\t\tbutton.style.display = 'none';\n\t\t\tstylizeElement( button );\n\t\t\tnavigator.xr.isSessionSupported( 'immersive-vr' ).then( function ( supported ) {\n\t\t\t\tsupported ? showEnterVR() : showWebXRNotFound();\n\t\t\t} );\n\t\t\treturn button;\n\n\t\t} else {\n\n\t\t\tconst message = document.createElement( 'a' );\n\t\t\tif ( window.isSecureContext === false ) {\n\t\t\t\tmessage.href = document.location.href.replace( /^http:/, 'https:' );\n\t\t\t\tmessage.innerHTML = 'WEBXR NEEDS HTTPS'; // TODO Improve message\n\t\t\t} else {\n\t\t\t\tmessage.href = 'https://immersiveweb.dev/';\n\t\t\t\tmessage.innerHTML = 'WEBXR NOT AVAILABLE';\n\t\t\t}\n\t\t\tmessage.style.left = 'calc(50% - 90px)';\n\t\t\tmessage.style.width = '180px';\n\t\t\tmessage.style.textDecoration = 'none';\n\t\t\tstylizeElement( message );\n\t\t\treturn message;\n\t\t}\n\t}\n}\n\n/*-- --*/\n\nexport class XRKIT {\n\n  static createRenderer( ctx = {} ) {\n    console.log('XRKIT.createRenderer');\n    let { clear = \"#000000\" } = ctx;\n    // Setup a ThreeJS renderer to render the scene\n    var renderer = new THREE.WebGLRenderer({ antialias: true });\n    renderer.setClearColor(clear);\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    // [VR] Enable WebXR support\n    renderer.xr.enabled = true;\n    return renderer;\n  }\n\n  static createCamera( ctx = {} ) {\n    let {\n      fov = 75, // Camera frustum vertical field of view\n      // Camera frustum aspect ratio\n      aspectRatio = window.innerWidth / window.innerHeight,\n      near = 0.1, // Camera frustum near plane\n      far = 1000, // Camera frustum far plane.\n    } = ctx;\n    // Create a ThreeJS camera\n    var camera = new THREE.PerspectiveCamera(fov, aspectRatio, near, far);\n    return camera;\n  }\n\n  static create(ctx = {}) {\n    var renderer = XRKIT.createRenderer(ctx);\n    document.body.appendChild(renderer.domElement);\n    // [VR] Append VR Button to scene\n    document.body.appendChild(XRBUTTON.createButton(renderer));\n    var camera = XRKIT.createCamera(ctx);\n    return {\n      renderer,\n      camera,\n    }\n  }\n\n  static render(ctx = {}) {\n    // set defaults so it won't crash\n    var scene = ctx.scene || new THREE.Scene();\n    var renderer = ctx.renderer || XRKIT.createRenderer(ctx);\n    var camera = ctx.camera || XRKIT.createCamera(ctx);\n    renderer.render(scene, camera);\n  }\n\n  static resize(ctx = {}) {\n    // set default so it won't crash\n    var renderer = ctx.renderer || XRKIT.createRenderer(ctx);\n    var camera = ctx.camera || XRKIT.createCamera(ctx);\n    camera.aspect = window.innerWidth / window.innerHeight;\n    camera.updateProjectionMatrix();\n    renderer.setSize(window.innerWidth, window.innerHeight);\n  }\n\n};"],"names":["XRBUTTON","createButton","renderer","console","log","button","document","createElement","stylizeElement","element","style","position","bottom","padding","border","borderRadius","background","color","font","textAlign","opacity","outline","zIndex","navigator","id","display","xr","isSessionSupported","then","supported","currentSession","onSessionStarted","session","addEventListener","onSessionEnded","setSession","textContent","removeEventListener","cursor","left","width","onmouseenter","onmouseleave","onclick","requestSession","optionalFeatures","end","showEnterVR","message","window","isSecureContext","href","location","replace","innerHTML","textDecoration","XRKIT","createRenderer","ctx","clear","THREE","WebGLRenderer","antialias","setClearColor","setSize","innerWidth","innerHeight","enabled","createCamera","fov","aspectRatio","near","far","PerspectiveCamera","create","body","appendChild","domElement","camera","render","scene","Scene","resize","aspect","updateProjectionMatrix"],"mappings":"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"}